# AI Agent Instructions for Blog Project

## Project Overview
A Laravel 12.0 blog application with user authentication, article CRUD operations, and comment system. Uses Laravel Breeze for auth, Blade templates with Tailwind CSS, and Vite for asset bundling.

## Core Architecture

### Data Model & Relations
- **Users** (`app/Models/User.php`): Implements `MustVerifyEmail`, stores `first_name`, `last_name`, `phone`. Uses Laravel Breeze auth.
- **Articles** (`app/Models/Article.php`): Belongs to User, has many Comments. Fields: `titre`, `contenu`, `banner_image`, `user_id`. Accessor: `getAuteurAttribute()` returns author name or 'Système'.
- **Comments** (`app/Models/Comment.php`): Belongs to Article and User. Fields: `content`, `article_id`, `user_id`.

### Controller Patterns
Controllers follow RESTful resource pattern with authorization checks:
- **ArticleController**: CRUD operations for articles. Inline auth checks in `create()`, `edit()`, `update()`, `destroy()` methods. Validates ownership: `$article->user_id !== Auth::id()` returns 403.
- **CommentController**: `store()` and `destroy()` only (no index/edit). Minimal - 60 lines total.
- **ProfileController & Auth**: Generated by Laravel Breeze, in `app/Http/Controllers/{ProfileController,Auth/}`

### Route Structure (`routes/web.php`)
- Public: `GET /`, `GET /articles`, `GET /articles/{id}` 
- Auth-required: Create/edit/delete articles, post/delete comments, profile management
- Middleware: `auth` for protected routes, `verified` for dashboard
- No API routes currently (listed in roadmap)

## Development Workflows

### Setup & Build
```bash
composer install                    # PHP dependencies
npm install                         # Node dependencies  
php artisan key:generate           # Generate APP_KEY in .env
php artisan migrate                # Run migrations
npm run dev                         # Start Vite dev server (watch mode)
php artisan serve                  # Serve on http://localhost:8000
```

### Database
- MySQL/PostgreSQL via `config/database.php` (set in `.env`)
- Migrations in `database/migrations/` with French comments
- Seeders in `database/seeders/` (UserFactory available)
- Latest migration: `2025_12_05_073403_create_comments_table.php`

### Testing
```bash
php artisan test                       # All tests in tests/
php artisan test --filter=ProfileTest # Specific test
```
Tests located in `tests/Feature/` and `tests/Unit/`

### Frontend Assets
- CSS: `resources/css/app.css` (Tailwind via `@tailwindcss/vite`)
- JS: `resources/js/app.js` bootstraps Alpine.js (v3.4.2)
- Vite config: `vite.config.js` (minimal, uses laravel-vite-plugin)
- Blade views: `resources/views/` (layouts, auth, components in subdirs)

## Critical Patterns & Conventions

### Authorization
**Decentralized in controllers** - No middleware, policies, or gate helpers used. Each method manually checks:
```php
if (!Auth::check()) return redirect()->route('login')->with('error', '...');
if ($article->user_id !== Auth::id()) abort(403, '...');
```
**When adding features**: Replicate this pattern rather than refactoring to use Laravel policies.

### File Uploads
- Images stored via `Storage::disk('public')->{store,delete}()` → `storage/app/public/`
- Article banners: `banniere_images/` subdirectory
- Max 2048KB, mimes: jpeg/png/jpg/gif
- Delete old file before updating: `if ($article->banner_image) Storage::disk('public')->delete(...)`
- Must symlink: `php artisan storage:link` (creates `public/storage`)

### Validation
- Inline in controllers using `$request->validate(array, messages)`
- French error messages in 3rd param, e.g., `'titre.required' => 'Le titre est obligatoire'`
- Always include custom messages for UX

### Database Timestamps
- All models auto-include `timestamps()` in migrations
- Comments ordered by: `->orderBy('created_at', 'desc')` in Article relation

### French Language
- Column/table names: `titre`, `contenu`, `banniere_images`
- Comments in code: French
- Validation messages: French
- Flash messages: French `->with('error'/'success', '...')`
- **Maintain this convention** in new features

## Common Tasks

### Adding a New Article Field
1. Create migration: `php artisan make:migration add_<field>_to_articles_table`
2. Add to `Article::$fillable` in model
3. Update validation in `ArticleController::store()` and `update()`
4. Add form input to `create.blade.php` and `edit.blade.php`

### Adding Comments Section
Already implemented. Pattern in `show.blade.php`:
- Display loop: `@foreach ($article->comments as $comment)`
- Create form: `POST /articles/{id}/comments` with CSRF token
- Delete button: `DELETE /comments/{id}` (ownership checked in controller)

### User Relations
Get authored articles: `$user->articles()` (add relation to User model if missing)
Get user comments: `$user->comments()` (same)

## Build & Deployment

### Caching (Production)
```bash
php artisan config:cache    # Cache config files
php artisan route:cache     # Compile routes
php artisan view:cache      # Compile views  
php artisan optimize        # Optimize autoloader
```

### File Permissions
```bash
chmod -R 755 storage bootstrap/cache
```

## Dependencies to Know
- **Laravel 12.0**: Framework (PSR-4 autoload: `App\` → `app/`)
- **Laravel Breeze 2.3**: Authentication scaffolding (login, register, password reset)
- **Tailwind CSS 3.1**: Styling via `@tailwindcss/forms`
- **Alpine.js 3.4**: Lightweight reactivity
- **Vite 7.0**: Module bundler (much faster than Mix)
- **PHPUnit 11.5**: Testing framework
- **Faker**: Generates fake data for seeding

## Key Files to Know
| File | Purpose |
|------|---------|
| `routes/web.php` | All route definitions with middleware |
| `app/Http/Controllers/ArticleController.php` | Main business logic |
| `app/Models/Article.php`, `User.php`, `Comment.php` | Data models with relations |
| `resources/views/layouts/app.blade.php` | Main layout template (check if exists) |
| `.env` | Database credentials, APP_KEY, APP_DEBUG |
| `config/app.php` | Timezone, locale (currently likely 'en', but use 'fr') |
